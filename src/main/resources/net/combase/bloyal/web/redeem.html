<!DOCTYPE html>
<html>
<head>
<title>Redeem bLoyal Gift Card</title>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<!-- Syntax highlighter-->
<link rel="stylesheet"
        href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/default.min.css"></link>
<script type="text/javascript"
        src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>

<script src="http://codemirror.net/lib/codemirror.js"></script>
<link rel="stylesheet" href="http://codemirror.net/lib/codemirror.css">
<script src="http://codemirror.net/mode/javascript/javascript.js"></script>
<script src="http://codemirror.net/addon/fold/foldcode.js"></script>
<link rel="stylesheet"
        href="http://codemirror.net/addon/fold/foldgutter.css"></link>
<script src="http://codemirror.net/addon/fold/foldgutter.js"></script>
<script src="http://codemirror.net/addon/fold/brace-fold.js"></script>
                                                                                                                                                                                                                          
<!-- jQuery -->                                                                                                                                                                                                           
<script src="jquery.min.js"></script>                                                                                                                                   
                                                                                                                                                                                                                          
<!-- Bootstrap -->                                                                                                                                                                                                        
<link rel="stylesheet" href="bootstrap.min.css"></link>                                                                                                                 
<link rel="stylesheet" href="bootstrap-theme.min.css"></link>                                                                                                           
<script src="bootstrap.min.js"></script>                                                                                                                                
                                                                                                                                                                                                                          
<!-- KORONA.pos-Client API module -->                                                                                                                                                                                     
<script type="text/javascript" src="korona-plugin-api.js"></script>                                                                                                     
<link rel="stylesheet" href="koronaposclient.css"></link>                                                                                                               
                                                                                                                                                                                                                          
<style>                                                                                                                                                                                                                   
code, kbd, pre, samp {                                                                                                                                                                                                    
        font-family: monospace;                                                                                                                                                                                           
}                                                                                                                                                                                                                         
                                                                                                                                                                                                                          
body {                                                                                                                                                                                                                    
        font-family: "Roboto", "Helvetica", "Arial", sans-serif;                                                                                                                                                          
}                                                                                                                                                                                                                         
                                                                                                                                                                                                                          
.CodeMirror {                                                                                                                                                                                                             
        height: auto;                                                                                                                                                                                                     
}
</style>

<script type="text/javascript">

        korona_plugin_api.response.identifyAs("BLoyal Plugin", "1");

        var amount=0;
        var receipt="000";
        window.onload = function myOnLoadFunc() {
        korona_plugin_api.ready(function myReadyFunc() {

                if (korona_plugin_api.request.inputLine == "")
                {
                        korona_plugin_api.response.displayMessage({
                                text: "Please enter the amount first.",
                                title: "Input Required",
                                level: "INFO"
                        });

                        korona_plugin_api.backToKorona();
                }
                else if (korona_plugin_api.request.inputLine > 0)
                        amount=korona_plugin_api.request.inputLine;

                var receipt=korona_plugin_api.request.receipt.number;

                document.getElementById('amount').innerHTML = amount;
        });
                document.getElementById('amount').innerHTML = amount;
        };

        function giftRequest(f)
        {
                f.accountNumber.disabled=true;
                params = "account="+encodeURI(f.accountNumber.value);
                params += "&amount="+encodeURI(amount);
                params += "&receipt="+encodeURI(receipt);

                $.ajax({
                        url: "/controller/charge?"+params,
                        type: "GET",
                        dataType: "text"
                }).done(function(data){
                        eval(data);
                });

                return false;
        }
</script>
<head>
<body>
        <form class="form" name="form1" action=""
                onsubmit="giftRequest(document.form1); return false;" style="margin:50px">

                <h1>Charge Gift Card - $<span id="amount">???</span></h1>
                <h3>Swipe, Scan or Enter Gift Card</h3>
                <div class="row">
                        <div class="col-xs-4">
                                <div class="form-group">
                                        <label class="sr-only" for="accountNumber">Account number*</label>
                                        <input class="form-control" type="text" name="accountNumber" id="accountNumber" rows="1" onblur="this.focus();"
                                                required="required" placeholder="Account number*"></input>
                                </div>
                        </div>
                </div>
                <div class="row">
                        <div class="col-xs-12">
                                <div class="form-group">
                                        <button class="btn btn-primary" type="submit">charge</button>

                                        <button class="btn btn-secundary" onclick="korona_plugin_api.showOsk();return false;">show keyboard</button>
                                </div>
                        </div>
                </div>
        </form>


<script type="text/javascript">
        document.getElementById("accountNumber").focus();
</script>
</body>
</html>
